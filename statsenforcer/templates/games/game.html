{% extends "wrappers/wrapper.html" %}
{% load website_extras %}
{% load pbp_extras %}
{% load staticfiles %}
{% block title %}{{ game.awayTeam_abbreviation }} vs {{ game.homeTeam_abbreviation }} {{ game.dateTime }} | WOI{% endblock %}
{% block meta %}
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en" />
<meta property="og:title" content="{{ game.awayTeam_abbreviation }} vs {{ game.homeTeam_abbreviation }} {{ game.dateTime }}" />
<meta itemprop="name" content="{{ game.awayTeam_abbreviation }} vs {{ game.homeTeam_abbreviation }} {{ game.dateTime }}" />
<meta property="og:type" content="website" />
<meta name="keywords" content="game, hockey, graphs, advanced stats, advanced statistics, fancy stats, fancystats, hockey stats, hockey statistics, waronice, war-on-ice, {{ game.homeTeam_name }}, {{ game.awayTeam_name }}, {{ game.awayTeam_abbreviation }}, {{ game.homeTeam_abbreviation }}, playoffs, standings, players, teams" />
<meta name="description" content="Game Page for {{ game.awayTeam_name }} vs {{ game.homeTeam_name }} on {{ game.dateTime }} on waronice.com. WAR On Ice provides advanced analytics and charts for hockey games and players." />
<meta property="og:description" content="Game Page for {{ game.awayTeam_name }} vs {{ game.homeTeam_name }} on {{ game.dateTime }} on waronice.com. WAR On Ice provides advanced analytics and charts for hockey games and players." />
<meta property="description" content="Game Page for {{ game.awayTeam_name }} vs {{ game.homeTeam_name }} on {{ game.dateTime }} on waronice.com. WAR On Ice provides advanced analytics and charts for hockey games and players." />
<meta name="locale" content="en" />
<meta name="lang" content="en_US" />
{% endblock %}
{% block page_css %}
<link href="{% static "css/datatables.min.css" %}" rel="stylesheet">
<link href="{% static "css/datatables-fontawesome.css" %}" rel="stylesheet">
<link href="{% static "css/fixedColumns.bootstrap.min.css" %}" rel="stylesheet">
<style>

    .axis path,
    .axis line {
      fill: none;
      stroke: rgba(0, 0, 0, 0.1);
      shape-rendering: crispEdges;
    }

    .axisLine {
      fill: none;
      shape-rendering: crispEdges;
      stroke: rgba(0, 0, 0, 0.5);
      stroke-width: 2px;
    }

    .dot {
      fill-opacity: .5;
    }

    .d3-tip {
      line-height: 1;
      font-weight: bold;
      padding: 12px;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      border-radius: 2px;
    }

    /* Creates a small triangle extender for the tooltip */
    .d3-tip:after {
      box-sizing: border-box;
      display: inline;
      font-size: 10px;
      width: 100%;
      line-height: 1;
      color: rgba(0, 0, 0, 0.8);
      content: "\25BC";
      position: absolute;
      text-align: center;
    }

    /* Style northward tooltips differently */
    .d3-tip.n:after {
      margin: -1px 0 0 0;
      top: 100%;
      left: 0;
    }
</style>
{% endblock %}
{% block content %}
{% with formstate=form|format_form_state %}
<div class="container">
    <div class="card">
        <div class="row">
            <div class="col-md-4 text-center">
                <img class="img-responsive img-center" style="margin-top:20%;" alt="{{ game.awayTeam_abbreviation }} logo" id="away-team-logo" align="middle" src='{% with 'img/team/'|add:game.awayTeam_abbreviation|add:'.png' as image_static %}{% static image_static %} {% endwith %}'>
            </div>
            <div class="col-md-4 text-center">
                <div class="row">
                    <div class="col-md-12">
                        <h3 class="away-team" id="away-team-name">{{ game.awayTeam_name }}</h3>
                        <h4>at</h4>
                        <h3 class="home-team" id="home-team-name">{{ game.homeTeam_name }}</h3>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <h3><span id="away-score">{{ game.awayScore }}</span> - <span id="home-score">{{ game.homeScore }}</span></h3>
                    </div>
                </div>
                {% if period is not None %}
                <div class="row">
                    <div class="col-md-12">
                        <h4><span id="periodTime">{{ periodTimeString }}</span>&nbsp;<span id="period">{{ period.period|get_period }}</span></h4>
                        <p><span id="liveUpdate"></span></p>
                    </div>
                </div>
                {% endif %}
                <div class="row">
                    <div class="col-md-12">
                        <h4>{{ game.dateTime }}{% if game.endDateTime %} - {{ game.endDateTime }}{% endif %}</h4>
                        <p><span id="liveUpdate"></span></p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <h4>{{ game.gameState|gameStatus }}{{ game|checkOT }}</h4>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-center">
                <h1><img class="img-responsive img-center" style="margin-top:20%;" alt="{{ game.homeTeam_abbreviation }} logo" id="away-team-logo" align="middle" src='{% with 'img/team/'|add:game.homeTeam_abbreviation|add:'.png' as image_static %}{% static image_static %} {% endwith %}'></h1>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="row">
            <div class="col-md-12">
                <div class="well bs-component">
                    <h4 class="filter-options" data-toggle="collapse" data-target="#gameFilter">
                    Filter Options
                    <img class="filter-collapsed" height="20" width="20" style="float: right"src="{% with 'img/arrow.svg' as image_static %}{% static image_static %} {% endwith %}">
                    </h4>
                    <div class="row">
                        <div class="col-md-12">
                            <form id="gameFilter" class="collapse" action="" method="GET">
                                <div class="row">
                                    <div class="col-md-4 col-sm-12">
                                        <div class="form-group">
                                            {{ form.teamstrengths.label }}
                                            {{ form.teamstrengths }}
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-12">
                                        <div class="form-group">
                                            {{ form.scoresituation.label }}
                                            {{ form.scoresituation }}
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-12">
                                        <div class="form-group">
                                            {{ form.period.label }}
                                            {{ form.period }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <button class="btn btn-primary" type="submit">Submit<div class="ripple-container"></div></button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card card-nav-tabs">
        <div class="header header-primary">
            <div class="nav-tabs-navigation">
                <div class="nav-tabs-wrapper">
                    <ul class="nav nav-tabs" data-tabs="tabs">
                        <li class="active">
                            <a href="#tableview" data-toggle="tab" aria-expanded="true">
                                Table View
                            <div class="ripple-container"></div></a>
                        </li>
                        <li class="">
                            <a href="#graphview" data-toggle="tab" aria-expanded="false">
                                Graph View
                            <div class="ripple-container"></div></a>
                        </li>
                        <li class="">
                            <a href="#pbpview" data-toggle="tab" aria-expanded="false">
                                Play By Play
                            <div class="ripple-container"></div></a>
                        </li>
                        <li class="">
                            <a href="#mediaview" data-toggle="tab" aria-expanded="false">
                                Media
                            <div class="ripple-container"></div></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="gameTabContent" class="content">
            <div class="content">
                <div class="tab-content">
                    <div class="tab-pane active" id="tableview">
                        <div class="card">
                            <div class="content">
                                <div class="row text-center">
                                    <div class="col-md-12">
                                        <h3>Team Statistics</h3>
                                        <p>{{ formstate }}</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="table-responsive">
                                            <table id="teamstats" class="table full-width table-condensed table-hover table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th class="text-center" title="Team">Team</th>
                                                        <th class="text-center" title="On-Ice Goals For Total">GF</th>
                                                        <th class="text-center" title="On-Ice Shots-On-Goal For Total">SF</th>
                                                        <th class="text-center" title="Missed Shots For">MSF</th>
                                                        <th class="text-center" title="Blocked Shots">BSF</th>
                                                        <th class="text-center" title="Corsi For Total">CF</th>
                                                        <th class="text-center" title="Corsi Shooting Percentage">CSh%</th>
                                                        <th class="text-center" title="Corsi Save Percentage">CSv%</th>
                                                        <th class="text-center" title="Fenwick For Total">FF</th>
                                                        <th class="text-center" title="Fenwick Shooting Percentage">FSh%</th>
                                                        <th class="text-center" title="Fenwick Save Percentage">FSv%</th>
                                                        <th class="text-center" title="PDO">PDO</th>
                                                        <th class="text-center" title="On-Ice Scoring Chances For Total">SCF</th>
                                                        <th class="text-center" title="On-Ice High-Danger Scoring Chances For Total">HSCF</th>
                                                        <th class="text-center" title="Offensive Zone Starts">ZSO</th>
                                                        <th class="text-center" title="Hits">HIT</th>
                                                        <th class="text-center" title="Penalties">PN</th>
                                                        <th class="text-center" title="Faceoffs Won">FO_W</th>
                                                        <th class="text-center" title="Time On Ice">TOI</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for team in teamstats %}
                                                    <tr>
                                                        <td class="text-center" title="Team"><a href="/teams/{{ team.shortName.split|join:"-" }}"><img height="17" width="17" src="{% static "/img/team/"|add:team.team|add:".png" %}" />&nbsp;&nbsp;{{ team.team }}</a></td>
                                                        <td class="text-center" title="On-Ice Goals For Total">{{ team.gf }}</td>
                                                        <td class="text-center" title="On-Ice Shots-On-Goal For Total">{{ team.sf }}</td>
                                                        <td class="text-center" title="Missed Shots For">{{ team.msf }}</td>
                                                        <td class="text-center" title="Blocked Shots">{{ team.bsf }}</td>
                                                        <td class="text-center" title="Corsi For Total">{{ team.cf }}</td>
                                                        <td class="text-center" title="">{{ team.csh }}</td>
                                                        <td class="text-center" title="">{{ team.csa }}</td>
                                                        <td class="text-center" title="Fenwick For Total">{{ team.ff }}</td>
                                                        <td class="text-center" title="">{{ team.fsh }}</td>
                                                        <td class="text-center" title="">{{ team.fsa }}</td>
                                                        <td class="text-center" title="PDO">{{ team.pdo }}</td>
                                                        <td class="text-center" title="On-Ice Scoring Chances For Total">{{ team.scf }}</td>
                                                        <td class="text-center" title="On-Ice High-Danger Scoring Chances For Total">{{ team.hscf }}</td>
                                                        <td class="text-center" title="Offensive Zone Starts">{{ team.zso }}</td>
                                                        <td class="text-center" title="Hits">{{ team.hit }}</td>
                                                        <td class="text-center" title="Penalties">{{ team.pn }}</td>
                                                        <td class="text-center" title="Faceoffs Won">{{ team.fo_w }}</td>
                                                        <td class="text-center" title="Time On Ice">{{ team.toi }}</td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="card">
                            <div class="content">
                                <div class="row text-center">
                                    <div class="col-md-12">
                                        <h3>Goalie Statistics</h3>
                                        <p>{{ formstate }}</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        {% include "games/goalietable.html" %}
                                    </div>
                                </div>
                            </div>
                        </div>
                            <div class="card">
                                <div class="content">
                                    <div class="row text-center">
                                        <div class="col-md-12">
                                            <h3>Player Statistics</h3>
                                            <p>{{ formstate }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="content">
                                    <div class="row">
                                        <div class="col-md-12">
                                            {% with team=game.homeTeam_id teamName=game.homeTeam_name team_abbreviation=game.homeTeam_abbreviation %}
                                                {% include "games/playertable.html" %}
                                            {% endwith %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="content">
                                    <div class="row">
                                        <div class="col-md-12">
                                            {% with team=game.awayTeam_id teamName=game.awayTeam_name team_abbreviation=game.awayTeam_abbreviation %}
                                                {% include "games/playertable.html" %}
                                            {% endwith %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                    </div>
                    <div class="tab-pane" id="graphview">
                        <div class="row">
                            <div class="col-md-12">
                                <h4 class="text-center">Shots Attempts&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-xs btn-primary" id="shotChartButton"><i class="fa fa-floppy-o"></i> Save</button></h4>
                                <div id="shotChart"></div>
                            </div>
                        </div>
                        <div class="row">
                            <h4 class="text-center">Event Chart (Shots)&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-xs btn-primary" id="eventChartShotsButton"><i class="fa fa-floppy-o"></i> Save</button></h4>
                            <div class="col-md-12">
                                <div id="eventChartShots"></div>
                            </div>
                        </div>
                        <div class="row">
                            <h4 class="text-center">Event Chart (Scoring Chances)&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-xs btn-primary" id="eventChartSCButton"><i class="fa fa-floppy-o"></i> Save</button></h4>
                            <div class="col-md-12">
                                <div id="eventChartSC"></div>
                            </div>
                        </div>
                        <div class="row">
                            <h4 class="text-center">Player Corsi Events</h4>
                            <p class="text-center">*Click points to toggle information</p>
                            <div class="col-md-6 col-sm-12">
                                <h4 class="text-center">Away Corsi&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-xs btn-primary" id="away-corsiButton"><i class="fa fa-floppy-o"></i> Save</button></h4>
                                <div id="away-corsi"></div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <h4 class="text-center">Home Corsi&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-xs btn-primary" id="home-corsiButton"><i class="fa fa-floppy-o"></i> Save</button></h4>
                                <div id="home-corsi"></div>
                            </div>
                        </div>
                        <div class="row">
                            <h4 class="text-center">Player Comparison&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-xs btn-primary" id="playerComparisonButton"><i class="fa fa-floppy-o"></i> Save</button></h4>
                            <div class="col-md-12">
                                <form>
                                    <div class="row text-center">
                                        <div class="col-md-3 col-sm-12">
                                            <div class="form-group">
                                                X-Axis
                                                <select class="form-control input-md" id="xaxis">
                                                    <option value="g">Goals</option>
                                                    <option value="a1">Primary Assists</option>
                                                    <option value="a2">Secondary Assists</option>
                                                    <option value="p">Points</option>
                                                    <option value="cf" selected="selected">Corsi For Total</option>
                                                    <option value="ca">Corsi Against Total</option>
                                                    <option value="ff">Fenwick For Total</option>
                                                    <option value="fa">Fenwick Against Total</option>
                                                    <option value="gf">On-Ice Goals For</option>
                                                    <option value="ga">On-Ice Goals Against</option>
                                                    <option value="iscf">Individual Scoring Chances For</option>
                                                    <option value="ihscf">Individual High Danger Scoring Chances For</option>
                                                    <option value="scf" selected>Scoring Chances For</option>
                                                    <option value="hscf">High Danger Scoring Chances For</option>
                                                    <option value="sca">Scoring Chances Against</option>
                                                    <option value="hsca">High Danger Scoring Chances Against</option>
                                                    <option value="fo_w">Faceoffs Won</option>
                                                    <option value="fo_l">Faceoffs Lost</option>
                                                    <option value="zso">Offensive Zone Starts</option>
                                                    <option value="zsn">Neutral Zone Starts</option>
                                                    <option value="zsd">Defensive Zone Starts</option>
                                                    <option value="hitplus">Hits</option>
                                                    <option value="hitminus">Hits Taken</option>
                                                    <option value="pnplus">Penalties</option>
                                                    <option value="pnminus">Penalties Taken</option>
                                                    <option value="toi">Time On Ice</option>

                                                </select>
                                            <span class="material-input"></span></div>
                                        </div>
                                        <div class="col-md-3 col-sm-12">
                                            <div class="form-group">
                                                Y-Axis
                                                <select class="form-control input-md" id="yaxis">
                                                    <option value="g">Goals</option>
                                                    <option value="a1">Primary Assists</option>
                                                    <option value="a2">Secondary Assists</option>
                                                    <option value="p">Points</option>
                                                    <option value="cf">Corsi For Total</option>
                                                    <option value="ca">Corsi Against Total</option>
                                                    <option value="ff">Fenwick For Total</option>
                                                    <option value="fa">Fenwick Against Total</option>
                                                    <option value="gf">On-Ice Goals For</option>
                                                    <option value="ga">On-Ice Goals Against</option>
                                                    <option value="iscf">Individual Scoring Chances For</option>
                                                    <option value="ihscf">Individual High Danger Scoring Chances For</option>
                                                    <option value="scf">Scoring Chances For</option>
                                                    <option value="hscf" selected="selected">High Danger Scoring Chances For</option>
                                                    <option value="sca" selected>Scoring Chances Against</option>
                                                    <option value="hsca">High Danger Scoring Chances Against</option>
                                                    <option value="fo_w">Faceoffs Won</option>
                                                    <option value="fo_l">Faceoffs Lost</option>
                                                    <option value="zso">Offensive Zone Starts</option>
                                                    <option value="zsn">Neutral Zone Starts</option>
                                                    <option value="zsd">Defensive Zone Starts</option>
                                                    <option value="hitplus">Hits</option>
                                                    <option value="hitminus">Hits Taken</option>
                                                    <option value="pnplus">Penalties</option>
                                                    <option value="pnminus">Penalties Taken</option>
                                                    <option value="toi">Time On Ice</option>
                                                </select>
                                            <span class="material-input"></span></div>
                                        </div>
                                        <div class="col-md-3 col-sm-12">
                                            <div class="form-group">
                                                Radius
                                                <select class="form-control input-md" id="raxis">
                                                    <option value="g">Goals</option>
                                                    <option value="a1">Primary Assists</option>
                                                    <option value="a2">Secondary Assists</option>
                                                    <option value="p">Points</option>
                                                    <option value="cf">Corsi For Total</option>
                                                    <option value="ca">Corsi Against Total</option>
                                                    <option value="ff">Fenwick For Total</option>
                                                    <option value="fa">Fenwick Against Total</option>
                                                    <option value="gf">On-Ice Goals For</option>
                                                    <option value="ga">On-Ice Goals Against</option>
                                                    <option value="iscf">Individual Scoring Chances For</option>
                                                    <option value="ihscf">Individual High Danger Scoring Chances For</option>
                                                    <option value="scf">Scoring Chances For</option>
                                                    <option value="hscf">High Danger Scoring Chances For</option>
                                                    <option value="sca">Scoring Chances Against</option>
                                                    <option value="hsca">High Danger Scoring Chances Against</option>
                                                    <option value="fo_w">Faceoffs Won</option>
                                                    <option value="fo_l">Faceoffs Lost</option>
                                                    <option value="zso" selected>Offensive Zone Starts</option>
                                                    <option value="zsn">Neutral Zone Starts</option>
                                                    <option value="zsd">Defensive Zone Starts</option>
                                                    <option value="hitplus">Hits</option>
                                                    <option value="hitminus">Hits Taken</option>
                                                    <option value="pnplus">Penalties</option>
                                                    <option value="pnminus">Penalties Taken</option>
                                                    <option value="toi">Time On Ice</option>
                                                </select>
                                            <span class="material-input"></span></div>
                                        </div>
                                        <div class="col-md-3 col-md-12">
                                            <div class="form-group">
                                                <button id="refreshGraph" class="btn btn-primary">Refresh<div class="ripple-container"></div></button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">

                                <div id="playerComparison"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="pbpview">
                        <div class="row">
                            <div class="col-md-12">
                                <table id="pbp" class="table table-striped table-hover table-condensed table-hover table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <th class="text-center">Period</th>
                                            <th class="text-center">Time</th>
                                            <th class="text-center">Score</th>
                                            <th class="text-center">Description</th>
                                            <th>On-Ice</th>
                                        </tr>
                                    </thead>
                                    <tbody class="table table-condensed">
                                        {% for play in playbyplay %}
                                        <tr>
                                            <td>{{ play.period }}</td>
                                            <td>{{ play.periodTimeString }}</td>
                                            <td>{{ play.homeScore }} - {{ play.awayScore }}</td>
                                            <td>
                                                {{ play|create_play_text|safe }}
                                                {% if play.id in playmedia %}
                                                <br />
                                                {% with media=playmedia|get_item:play.id %}
                                                <div class="image-container">
                                                    <a target="_blank" href="{{ media.url }}">
                                                        <img src="{{ media.preview }}" class="img img-responsive image-preview" />
                                                        <div class="after">
                                                            <span class="image-content">View on NHL.com</span>
                                                            <span class="zoom">
                                                                <i class="fa fa-play-circle-o" aria-hidden="true"></i>
                                                            </span>
                                                        </div>
                                                    </a>
                                                </div>
                                                {{ media.blurb }}
                                                {% endwith %}
                                                {% endif %}
                                            </td>
                                            <td>
                                                <table class="table table-bordered table-striped table-condensed table-hover">
                                                    <tbody>
                                                        <tr>
                                                            <th>{{ game.awayTeam_abbreviation }}</th>
                                                            {% for player in play.onice %}
                                                                {% if player.team_id == game.awayTeam_id %}
                                                                <td>{{ player.player__lastName }}<br />{{ player.player__primaryPositionCode }}</td>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </tr>
                                                        <tr>
                                                            <th>{{ game.homeTeam_abbreviation }}</th>
                                                            {% for player in play.onice %}
                                                                {% if player.team_id == game.homeTeam_id %}
                                                                <td>{{ player.player__lastName }}<br />{{ player.player__primaryPositionCode }}</td>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="mediaview">
                        <div class="row">
                            <div class="col-md-12">
                                <table id="media" class="table table-striped table-hover table-condensed">
                                    <thead>
                                        <tr>
                                            <th class="text-center">Media</th>
                                        </tr>
                                    </thead>
                                    <tbody class="table table-condensed">
                                        {% for playid, media in playmedia.items %}
                                        <tr>
                                            <td class="text-center">
                                                <h4>{{ media.blurb }}</h4>
                                                <div class="image-container">
                                                    <a target="_blank" href="{{ media.url }}">
                                                        <img src="{{ media.preview }}" class="img img-responsive image-preview" />
                                                        <div class="after">
                                                            <span class="image-content">View on NHL.com</span>
                                                            <span class="zoom">
                                                                <i class="fa fa-play-circle-o" aria-hidden="true"></i>
                                                            </span>
                                                        </div>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<div id="canvasArea">
    <canvas style="display:none;" id="canvas" width="1000px" height="700px"></canvas>
</div>
{% endwith %}
{% endblock %}
{% block page_js %}
{% with formstate=form|format_form_state %}
<script src="{% static "js/datatables.min.js" %}"></script>
<script src="{% static "js/d3.min.js" %}"></script>
<script src="{% static "js/d3.tip.js" %}"></script>
<script src="{% static "js/teamColors.js" %}"></script>
<script src="{% static "js/graphs/shotChart.js" %}"></script>
<script src="{% static "js/graphs/corsiEventChart.js" %}"></script>
<script src="{% static "js/graphs/eventChart.js" %}"></script>
<script src="{% static "js/graphs/zoomchart.js" %}"></script>
<script type="text/javascript" src="{% static "js/graphs/canvg/rgbcolor.js" %}"></script>
<script type="text/javascript" src="{% static "js/graphs/canvg/StackBlur.js" %}"></script>
<script type="text/javascript" src="{% static "js/graphs/canvg/canvg.js" %}"></script>
<script src="{% static "js/graphs/savePNG.js" %}"></script>
<script>
    $(document).ready(function() {


        $('#pbp').DataTable({
            "iDisplayLength": 10,
            "bSort": false
        });

        var z = $('#{{ game.awayTeam_abbreviation }}-players').DataTable({
            "iDisplayLength": 18,
            "bPaginate": false,

            scrollX: true,
            "fixedColumns": {
                leftColumns: 1,
            },
            dom: "<'row'<'col-sm-6'l><'col-sm-6'f>>" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-5'i><'col-sm-7'p>>" +
                "<'col-sm-12'B>",
            buttons: [{
                extend: 'copy',
                className: 'btn-sm btn-primary',
            }, {
                extend: 'csv',
                className: 'btn-sm btn-primary',
            }, {
                extend: 'excel',
                className: 'btn-sm btn-primary',
            }]
        });

        $('#{{ game.homeTeam_abbreviation }}-players').DataTable({
            "iDisplayLength": 18,
            "bPaginate": false,
            scrollX: true,
            "fixedColumns": {
                leftColumns: 1,
            },
            dom: "<'row'<'col-sm-6'l><'col-sm-6'f>>" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-5'i><'col-sm-7'p>>" +
                "<'col-sm-12'B>",
            buttons: [{
                extend: 'copy',
                className: 'btn-sm btn-primary',
            }, {
                extend: 'csv',
                className: 'btn-sm btn-primary',
            }, {
                extend: 'excel',
                className: 'btn-sm btn-primary',
            }]
        });

        $('#teamstats').DataTable({
            "iDisplayLength": 10,
            "bPaginate": false,
            scrollX: true,
            "fixedColumns": {
                leftColumns: 1,
            },
            dom: "<'row'<'col-sm-6'l><'col-sm-6'f>>" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-5'i><'col-sm-7'p>>" +
                "<'col-sm-12'B>",
            buttons: [{
                extend: 'copy',
                className: 'btn-sm btn-primary',
            }, {
                extend: 'csv',
                className: 'btn-sm btn-primary',
            }, {
                extend: 'excel',
                className: 'btn-sm btn-primary',
            }]
        });

        $('#goalietable').DataTable({
            "iDisplayLength": 10,
            "bPaginate": false,
            "scrollX": true,
            "fixedColumns": {
                leftColumns: 1,
            },
            dom: "<'row'<'col-sm-6'l><'col-sm-6'f>>" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-5'i><'col-sm-7'p>>" +
                "<'col-sm-12'B>",
            buttons: [{
                extend: 'copy',
                className: 'btn-sm btn-primary',
            }, {
                extend: 'csv',
                className: 'btn-sm btn-primary',
            }, {
                extend: 'excel',
                className: 'btn-sm btn-primary',
            }]
        });


        //Creates the corsi graphs
        var playerStats = JSON.parse("{{ playersjson | escapejs }}");
        var homeSkaters = playerStats["{{ game.homeTeam_id }}"];
        var awaySkaters = playerStats["{{ game.awayTeam_id }}"];
        create_corsi_events(homeSkaters, "#home-corsi", "{{ game.homeTeam_abbreviation }}", "{{ formstate }}");
        create_corsi_events(awaySkaters, "#away-corsi", "{{ game.awayTeam_abbreviation }}", "{{ formstate }}");

        var eventChart = {{ eventChart| safe }};
        create_shot_attempts(eventChart, "#eventChartShots", "Shots", "{{ formstate }}");
        create_shot_attempts(eventChart, "#eventChartSC", "SC", "{{ formstate }}");

        //shot graph
        var shotData = JSON.parse("{{ shotdatajson | escapejs }}");
        shotChart(shotData, "{{ game.homeTeam_abbreviation }}", "{{ game.awayTeam_abbreviation }}", "{{ form|format_form_state }}", "{{ formstate }}");


        var xCat = $('#xaxis').find(":selected").val(),
            yCat = $('#yaxis').find(":selected").val(),
            rCat = $('#raxis').find(":selected").val();
        var xText = $('#xaxis').find(":selected").text(),
            yText = $('#yaxis').find(":selected").text(),
            rText = $('#raxis').find(":selected").text();

        var playerStatsFormatted = [];
        var teamNames = {};
        teamNames["{{ game.awayTeam_id }}"] = "{{ game.awayTeam_abbreviation }}"
        teamNames["{{ game.homeTeam_id }}"] = "{{ game.homeTeam_abbreviation }}"

        for (team in playerStats) {
            for (player in playerStats[team]) {
                playerStats[team][player].team = teamNames[playerStats[team][player].team];
                playerStats[team][player].fullName = playerStats[team][player].name;
                playerStats[team][player].player_id = player;
                playerStatsFormatted.push(playerStats[team][player])
            }
        };

        zoomchart('#playerComparison', "#gameTabContent", playerStatsFormatted, xCat, yCat, rCat, xText, yText, rText, "Player", "player_id");
        savePNG("#playerComparisonButton", "#playerComparison");

        $('#refreshGraph').click(function(e) {
            e.preventDefault();
            var xCat = $('#xaxis').find(":selected").val(),
                yCat = $('#yaxis').find(":selected").val(),
                rCat = $('#raxis').find(":selected").val();
            var xText = $('#xaxis').find(":selected").text(),
                yText = $('#yaxis').find(":selected").text(),
                rText = $('#raxis').find(":selected").text();
            zoomchart('#playerComparison', "#gameTabContent", playerStatsFormatted, xCat, yCat, rCat, xText, yText, rText, "Player", "player_id");
        });

        savePNG("#shotChartButton", "#shotChart");
        savePNG("#eventChartShotsButton", "#eventChartShots");
        savePNG("#eventChartSCButton", "#eventChartSC");
        savePNG("#home-corsiButton", "#home-corsi");
        savePNG("#away-corsiButton", "#away-corsi");

    });

    $('.filter-options').click(function(e) {
        var icon = $('.filter-options img');
        if (icon.hasClass('filter-collapsed')) {
            icon.removeClass('filter-collapsed');
            icon.addClass('filter-expanded');
        } else {
            icon.removeClass('filter-expanded');
            icon.addClass('filter-collapsed');
        }
    });
{% endwith %}
</script>
{% endblock %}
